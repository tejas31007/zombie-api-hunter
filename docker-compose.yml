version: '3.8'

services:
  # 1. The Brain (Redis Database) - Docker handles the installation!
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
    networks:
      - zombie-net
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # 2. The Hunter (API Proxy)
  proxy:
    build:
      context: .
      dockerfile: Dockerfile.proxy
    ports:
      - "8000:8000"
    environment:
      # Tell the app to look for the "redis" container, not "localhost"
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - TARGET_URL=http://example.com
    depends_on:
      redis:
        condition: service_healthy
    networks:
      - zombie-net

  # 3. The Monitor (Dashboard)
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile.dashboard
    ports:
      - "8501:8501"
    environment:
      # Dashboard talks to the API via the 'proxy' service name
      - PROXY_URL=http://proxy:8000
      - REDIS_HOST=redis
    depends_on:
      - proxy
    networks:
      - zombie-net

networks:
  zombie-net:
    driver: bridge